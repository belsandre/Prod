{% extends "base.html" %}

{% block title %}{% if parent_job %}Reply to Job #{{ parent_job.id }}{% else %}Submit Job{% endif %} - Claude Code Job Queue{% endblock %}

{% block content %}
{% if parent_job %}
<div class="card" style="background: #e7f3ff; border-left: 4px solid #007bff;">
    <h2>Replying to Conversation</h2>
    <p><strong>Parent Job:</strong> #{{ parent_job.id }} - {{ parent_job.job_type }}</p>
    {% if parent_job.prompt %}
    <p><strong>Original Prompt:</strong></p>
    <div style="padding: 0.5rem; background: white; border-radius: 4px; margin-top: 0.5rem;">
        {{ parent_job.prompt[:200] }}{% if parent_job.prompt|length > 200 %}...{% endif %}
    </div>
    {% endif %}
    <p style="margin-top: 1rem; color: #0056b3;">
        Your reply will continue this conversation. Claude Code will have access to the full conversation history.
    </p>
</div>
{% endif %}

<div class="card">
    <h2>{% if parent_job %}Reply to Job #{{ parent_job.id }}{% else %}Submit New Job{% endif %}</h2>

    <form method="POST" enctype="multipart/form-data">
        {% if parent_job %}
        <input type="hidden" name="parent_job_id" value="{{ parent_job.id }}">
        {% endif %}
        <input type="hidden" name="job_type" value="{{ parent_job.job_type if parent_job else 'general' }}">

        <div class="form-section">
            <h3>1. Inputs</h3>
            <p class="form-help" style="margin-top: 0;">
                Inputs can be files you upload or any URLs to websites, products, data rooms, decks, etc.
                Include any relevant directions for how to log in or navigate protected content.
            </p>
            <div class="form-group">
                <label for="files">Upload Files (Optional)</label>
                <input type="file" id="files" name="files" multiple>
                <div class="form-help">
                    Supported formats: txt, pdf, png, jpg, gif, csv, json, xml, md, py, js, html, css, zip, tar, gz (50MB max per file)
                </div>
            </div>

            <div class="form-group">
                <label for="input_urls">URLs (include any login directions)</label>
                <textarea id="input_urls" name="input_urls" placeholder="https://app.example.com
Username: demo@example.com
Password: ********
Notes: Start on the analytics tab and export the weekly report."></textarea>
                <div class="form-help">
                    List any URLs or references Claude should open, along with credentials or access notes if needed.
                </div>
            </div>
        </div>

        <div class="form-section">
            <h3>2. Choose workflows</h3>
            <div class="form-group">
                <label for="workflows">Available workflows</label>
                {% if workflow_groups %}
                <select id="workflows" name="workflows" multiple size="6">
                    {% for group in workflow_groups %}
                    <optgroup label="{{ group.label }}">
                        {% for workflow in group.options %}
                        <option value="{{ workflow.value }}">{{ workflow.label }}</option>
                        {% endfor %}
                    </optgroup>
                    {% endfor %}
                </select>
                <div class="form-help">Hold Cmd/Ctrl to select multiple workflows.</div>
                {% else %}
                <div class="form-help">No workflows found yet. Upload files or proceed with custom instructions.</div>
                {% endif %}
            </div>

            <div class="form-group">
                <label for="custom_instructions">Custom instructions</label>
                <textarea id="custom_instructions" name="custom_instructions" placeholder="Share evaluation criteria, edge cases, or anything else Claude should know to complete the task.
Output as a file in the default outputs folder, emailed to you, or modifying a specified file."></textarea>
                <div class="form-help">Be as specific as possible about success criteria and how you want the output.</div>
            </div>
        </div>

        <div class="form-group">
            <label for="priority">Priority</label>
            <select id="priority" name="priority">
                <option value="0">Normal</option>
                <option value="5">High</option>
                <option value="10">Urgent</option>
                <option value="-5">Low</option>
            </select>
            <div class="form-help">Higher priority jobs are processed first</div>
        </div>

        <div style="display: flex; gap: 1rem;">
            <button type="submit" class="btn btn-success">Submit Job</button>
            <a href="{{ url_for('dashboard') }}" class="btn btn-secondary">Cancel</a>
        </div>
    </form>
</div>

<div class="card">
    <h2>How It Works</h2>
    <ol style="padding-left: 1.5rem; line-height: 2;">
        <li>Submit your job with instructions and/or files</li>
        {% if processing_mode == 'manual' %}
        <li>Your job will be added to the pending queue</li>
        <li>You or an admin must approve the job before processing</li>
        <li>Once approved, the job enters the processing queue</li>
        {% else %}
        <li>Your job will be automatically approved and queued</li>
        {% endif %}
        <li>Claude Code will pick up the job and process it</li>
        <li>You can view the output once the job completes</li>
    </ol>
</div>
{% endblock %}
