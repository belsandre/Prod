{% extends "base.html" %}

{% block title %}Edit Job #{{ job.id }} - Claude Code Job Queue{% endblock %}

{% block content %}
<h1 style="margin-bottom: 1.5rem;">Edit Job #{{ job.id }}</h1>

<div class="card">
    <p style="margin-top: 0; color: #7f8c8d;">
        {% if is_admin %}
            You can edit any job. Changes take effect immediately and are logged on this ticket.
        {% else %}
            You can edit this job while it is pending approval. Once it moves to processing you will no longer be able to make changes.
        {% endif %}
    </p>

    <form method="POST" enctype="multipart/form-data">
        <div class="form-section">
            <h3>Inputs</h3>
            {% if existing_files %}
            <div class="form-group">
                <label>Current Files</label>
                <ul>
                    {% for filepath in existing_files %}
                    <li><code>{{ filepath.split('/')[-1] }}</code></li>
                    {% endfor %}
                </ul>
                <div class="form-help">Existing files stay attached. Upload more to add to the list.</div>
            </div>
            {% endif %}

            <div class="form-group">
                <label for="files">Upload Additional Files</label>
                <input type="file" id="files" name="files" multiple>
                <div class="form-help">New uploads are appended to the job (50MB per file max).</div>
            </div>

            <div class="form-group">
                <label for="input_urls">URLs & Access Notes</label>
                <textarea id="input_urls" name="input_urls">{{ form_data.input_urls }}</textarea>
                <div class="form-help">List URLs and login instructions. Leave blank to remove previous entries.</div>
            </div>
        </div>

        <div class="form-section">
            <h3>Workflows & Instructions</h3>
            <div class="form-group">
                <label for="workflows">Available workflows</label>
                {% if workflow_groups %}
                <select id="workflows" name="workflows" multiple size="6">
                    {% for group in workflow_groups %}
                    <optgroup label="{{ group.label }}">
                        {% for workflow in group.options %}
                        <option value="{{ workflow.value }}" {% if workflow.value in selected_workflows %}selected{% endif %}>
                            {{ workflow.label }}
                        </option>
                        {% endfor %}
                    </optgroup>
                    {% endfor %}
                </select>
                <div class="form-help">Hold Cmd/Ctrl to select multiple workflows.</div>
                {% else %}
                <div class="form-help">No workflows available yet. You can still add custom instructions.</div>
                {% endif %}
            </div>

            <div class="form-group">
                <label for="custom_instructions">Custom instructions</label>
                <textarea id="custom_instructions" name="custom_instructions">{{ form_data.custom_instructions }}</textarea>
                <div class="form-help">Update the request details or leave blank to rely on files/URLs.</div>
            </div>
        </div>

        <div class="form-group">
            <label for="priority">Priority</label>
            <select id="priority" name="priority">
                {% set priority_value = form_data.priority|string %}
                <option value="0" {% if priority_value == '0' %}selected{% endif %}>Normal</option>
                <option value="5" {% if priority_value == '5' %}selected{% endif %}>High</option>
                <option value="10" {% if priority_value == '10' %}selected{% endif %}>Urgent</option>
                <option value="-5" {% if priority_value == '-5' %}selected{% endif %}>Low</option>
            </select>
            <div class="form-help">Higher priority jobs surface earlier when processing.</div>
        </div>

        <div style="display: flex; gap: 1rem;">
            <button type="submit" class="btn btn-success">Save Changes</button>
            <a href="{{ url_for('view_job', job_id=job.id) }}" class="btn btn-secondary">Cancel</a>
        </div>
    </form>
</div>
{% endblock %}
